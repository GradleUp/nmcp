buildscript {
    repositories {
        mavenCentral()
    }

    dependencies {
        classpath("build-logic:build-logic")
    }
}

plugins {
    id("com.gradleup.nmcp").version("0.0.5")
}


nmcp {
    publishAggregation {
        project(":module1")
        project(":module2")

        username = System.getenv("MAVEN_CENTRAL_USERNAME")
        password = System.getenv("MAVEN_CENTRAL_PASSWORD")
        publicationType = "USER_MANAGED"
    }
}

tasks.register("checkZip") {
    inputs.file(tasks.named("zipAggregationPublication").flatMap { (it as Zip).archiveFile })

    doLast {
        val paths = mutableListOf<String>()
        zipTree(inputs.files.singleFile).visit {
            paths.add(this.path)
        }

        check(
            paths.sorted().equals(
                listOf(
                    "sample",
                    "sample/kmp",
                    "sample/kmp/module1",
                    "sample/kmp/module1-js",
                    "sample/kmp/module1-js/0.0.1",
                    "sample/kmp/module1-js/0.0.1/module1-js-0.0.1-sources.jar",
                    "sample/kmp/module1-js/0.0.1/module1-js-0.0.1-sources.jar.md5",
                    "sample/kmp/module1-js/0.0.1/module1-js-0.0.1-sources.jar.sha1",
                    "sample/kmp/module1-js/0.0.1/module1-js-0.0.1-sources.jar.sha256",
                    "sample/kmp/module1-js/0.0.1/module1-js-0.0.1-sources.jar.sha512",
                    "sample/kmp/module1-js/0.0.1/module1-js-0.0.1.klib",
                    "sample/kmp/module1-js/0.0.1/module1-js-0.0.1.klib.md5",
                    "sample/kmp/module1-js/0.0.1/module1-js-0.0.1.klib.sha1",
                    "sample/kmp/module1-js/0.0.1/module1-js-0.0.1.klib.sha256",
                    "sample/kmp/module1-js/0.0.1/module1-js-0.0.1.klib.sha512",
                    "sample/kmp/module1-js/0.0.1/module1-js-0.0.1.module",
                    "sample/kmp/module1-js/0.0.1/module1-js-0.0.1.module.md5",
                    "sample/kmp/module1-js/0.0.1/module1-js-0.0.1.module.sha1",
                    "sample/kmp/module1-js/0.0.1/module1-js-0.0.1.module.sha256",
                    "sample/kmp/module1-js/0.0.1/module1-js-0.0.1.module.sha512",
                    "sample/kmp/module1-js/0.0.1/module1-js-0.0.1.pom",
                    "sample/kmp/module1-js/0.0.1/module1-js-0.0.1.pom.md5",
                    "sample/kmp/module1-js/0.0.1/module1-js-0.0.1.pom.sha1",
                    "sample/kmp/module1-js/0.0.1/module1-js-0.0.1.pom.sha256",
                    "sample/kmp/module1-js/0.0.1/module1-js-0.0.1.pom.sha512",
                    "sample/kmp/module1-jvm",
                    "sample/kmp/module1-jvm/0.0.1",
                    "sample/kmp/module1-jvm/0.0.1/module1-jvm-0.0.1-sources.jar",
                    "sample/kmp/module1-jvm/0.0.1/module1-jvm-0.0.1-sources.jar.md5",
                    "sample/kmp/module1-jvm/0.0.1/module1-jvm-0.0.1-sources.jar.sha1",
                    "sample/kmp/module1-jvm/0.0.1/module1-jvm-0.0.1-sources.jar.sha256",
                    "sample/kmp/module1-jvm/0.0.1/module1-jvm-0.0.1-sources.jar.sha512",
                    "sample/kmp/module1-jvm/0.0.1/module1-jvm-0.0.1.jar",
                    "sample/kmp/module1-jvm/0.0.1/module1-jvm-0.0.1.jar.md5",
                    "sample/kmp/module1-jvm/0.0.1/module1-jvm-0.0.1.jar.sha1",
                    "sample/kmp/module1-jvm/0.0.1/module1-jvm-0.0.1.jar.sha256",
                    "sample/kmp/module1-jvm/0.0.1/module1-jvm-0.0.1.jar.sha512",
                    "sample/kmp/module1-jvm/0.0.1/module1-jvm-0.0.1.module",
                    "sample/kmp/module1-jvm/0.0.1/module1-jvm-0.0.1.module.md5",
                    "sample/kmp/module1-jvm/0.0.1/module1-jvm-0.0.1.module.sha1",
                    "sample/kmp/module1-jvm/0.0.1/module1-jvm-0.0.1.module.sha256",
                    "sample/kmp/module1-jvm/0.0.1/module1-jvm-0.0.1.module.sha512",
                    "sample/kmp/module1-jvm/0.0.1/module1-jvm-0.0.1.pom",
                    "sample/kmp/module1-jvm/0.0.1/module1-jvm-0.0.1.pom.md5",
                    "sample/kmp/module1-jvm/0.0.1/module1-jvm-0.0.1.pom.sha1",
                    "sample/kmp/module1-jvm/0.0.1/module1-jvm-0.0.1.pom.sha256",
                    "sample/kmp/module1-jvm/0.0.1/module1-jvm-0.0.1.pom.sha512",
                    "sample/kmp/module1-linuxarm64",
                    "sample/kmp/module1-linuxarm64/0.0.1",
                    "sample/kmp/module1-linuxarm64/0.0.1/module1-linuxarm64-0.0.1-sources.jar",
                    "sample/kmp/module1-linuxarm64/0.0.1/module1-linuxarm64-0.0.1-sources.jar.md5",
                    "sample/kmp/module1-linuxarm64/0.0.1/module1-linuxarm64-0.0.1-sources.jar.sha1",
                    "sample/kmp/module1-linuxarm64/0.0.1/module1-linuxarm64-0.0.1-sources.jar.sha256",
                    "sample/kmp/module1-linuxarm64/0.0.1/module1-linuxarm64-0.0.1-sources.jar.sha512",
                    "sample/kmp/module1-linuxarm64/0.0.1/module1-linuxarm64-0.0.1.klib",
                    "sample/kmp/module1-linuxarm64/0.0.1/module1-linuxarm64-0.0.1.klib.md5",
                    "sample/kmp/module1-linuxarm64/0.0.1/module1-linuxarm64-0.0.1.klib.sha1",
                    "sample/kmp/module1-linuxarm64/0.0.1/module1-linuxarm64-0.0.1.klib.sha256",
                    "sample/kmp/module1-linuxarm64/0.0.1/module1-linuxarm64-0.0.1.klib.sha512",
                    "sample/kmp/module1-linuxarm64/0.0.1/module1-linuxarm64-0.0.1.module",
                    "sample/kmp/module1-linuxarm64/0.0.1/module1-linuxarm64-0.0.1.module.md5",
                    "sample/kmp/module1-linuxarm64/0.0.1/module1-linuxarm64-0.0.1.module.sha1",
                    "sample/kmp/module1-linuxarm64/0.0.1/module1-linuxarm64-0.0.1.module.sha256",
                    "sample/kmp/module1-linuxarm64/0.0.1/module1-linuxarm64-0.0.1.module.sha512",
                    "sample/kmp/module1-linuxarm64/0.0.1/module1-linuxarm64-0.0.1.pom",
                    "sample/kmp/module1-linuxarm64/0.0.1/module1-linuxarm64-0.0.1.pom.md5",
                    "sample/kmp/module1-linuxarm64/0.0.1/module1-linuxarm64-0.0.1.pom.sha1",
                    "sample/kmp/module1-linuxarm64/0.0.1/module1-linuxarm64-0.0.1.pom.sha256",
                    "sample/kmp/module1-linuxarm64/0.0.1/module1-linuxarm64-0.0.1.pom.sha512",
                    "sample/kmp/module1/0.0.1",
                    "sample/kmp/module1/0.0.1/module1-0.0.1-kotlin-tooling-metadata.json",
                    "sample/kmp/module1/0.0.1/module1-0.0.1-kotlin-tooling-metadata.json.md5",
                    "sample/kmp/module1/0.0.1/module1-0.0.1-kotlin-tooling-metadata.json.sha1",
                    "sample/kmp/module1/0.0.1/module1-0.0.1-kotlin-tooling-metadata.json.sha256",
                    "sample/kmp/module1/0.0.1/module1-0.0.1-kotlin-tooling-metadata.json.sha512",
                    "sample/kmp/module1/0.0.1/module1-0.0.1-sources.jar",
                    "sample/kmp/module1/0.0.1/module1-0.0.1-sources.jar.md5",
                    "sample/kmp/module1/0.0.1/module1-0.0.1-sources.jar.sha1",
                    "sample/kmp/module1/0.0.1/module1-0.0.1-sources.jar.sha256",
                    "sample/kmp/module1/0.0.1/module1-0.0.1-sources.jar.sha512",
                    "sample/kmp/module1/0.0.1/module1-0.0.1.jar",
                    "sample/kmp/module1/0.0.1/module1-0.0.1.jar.md5",
                    "sample/kmp/module1/0.0.1/module1-0.0.1.jar.sha1",
                    "sample/kmp/module1/0.0.1/module1-0.0.1.jar.sha256",
                    "sample/kmp/module1/0.0.1/module1-0.0.1.jar.sha512",
                    "sample/kmp/module1/0.0.1/module1-0.0.1.module",
                    "sample/kmp/module1/0.0.1/module1-0.0.1.module.md5",
                    "sample/kmp/module1/0.0.1/module1-0.0.1.module.sha1",
                    "sample/kmp/module1/0.0.1/module1-0.0.1.module.sha256",
                    "sample/kmp/module1/0.0.1/module1-0.0.1.module.sha512",
                    "sample/kmp/module1/0.0.1/module1-0.0.1.pom",
                    "sample/kmp/module1/0.0.1/module1-0.0.1.pom.md5",
                    "sample/kmp/module1/0.0.1/module1-0.0.1.pom.sha1",
                    "sample/kmp/module1/0.0.1/module1-0.0.1.pom.sha256",
                    "sample/kmp/module1/0.0.1/module1-0.0.1.pom.sha512",
                    "sample/kmp/module2",
                    "sample/kmp/module2-js",
                    "sample/kmp/module2-js/0.0.1",
                    "sample/kmp/module2-js/0.0.1/module2-js-0.0.1-sources.jar",
                    "sample/kmp/module2-js/0.0.1/module2-js-0.0.1-sources.jar.md5",
                    "sample/kmp/module2-js/0.0.1/module2-js-0.0.1-sources.jar.sha1",
                    "sample/kmp/module2-js/0.0.1/module2-js-0.0.1-sources.jar.sha256",
                    "sample/kmp/module2-js/0.0.1/module2-js-0.0.1-sources.jar.sha512",
                    "sample/kmp/module2-js/0.0.1/module2-js-0.0.1.klib",
                    "sample/kmp/module2-js/0.0.1/module2-js-0.0.1.klib.md5",
                    "sample/kmp/module2-js/0.0.1/module2-js-0.0.1.klib.sha1",
                    "sample/kmp/module2-js/0.0.1/module2-js-0.0.1.klib.sha256",
                    "sample/kmp/module2-js/0.0.1/module2-js-0.0.1.klib.sha512",
                    "sample/kmp/module2-js/0.0.1/module2-js-0.0.1.module",
                    "sample/kmp/module2-js/0.0.1/module2-js-0.0.1.module.md5",
                    "sample/kmp/module2-js/0.0.1/module2-js-0.0.1.module.sha1",
                    "sample/kmp/module2-js/0.0.1/module2-js-0.0.1.module.sha256",
                    "sample/kmp/module2-js/0.0.1/module2-js-0.0.1.module.sha512",
                    "sample/kmp/module2-js/0.0.1/module2-js-0.0.1.pom",
                    "sample/kmp/module2-js/0.0.1/module2-js-0.0.1.pom.md5",
                    "sample/kmp/module2-js/0.0.1/module2-js-0.0.1.pom.sha1",
                    "sample/kmp/module2-js/0.0.1/module2-js-0.0.1.pom.sha256",
                    "sample/kmp/module2-js/0.0.1/module2-js-0.0.1.pom.sha512",
                    "sample/kmp/module2-jvm",
                    "sample/kmp/module2-jvm/0.0.1",
                    "sample/kmp/module2-jvm/0.0.1/module2-jvm-0.0.1-sources.jar",
                    "sample/kmp/module2-jvm/0.0.1/module2-jvm-0.0.1-sources.jar.md5",
                    "sample/kmp/module2-jvm/0.0.1/module2-jvm-0.0.1-sources.jar.sha1",
                    "sample/kmp/module2-jvm/0.0.1/module2-jvm-0.0.1-sources.jar.sha256",
                    "sample/kmp/module2-jvm/0.0.1/module2-jvm-0.0.1-sources.jar.sha512",
                    "sample/kmp/module2-jvm/0.0.1/module2-jvm-0.0.1.jar",
                    "sample/kmp/module2-jvm/0.0.1/module2-jvm-0.0.1.jar.md5",
                    "sample/kmp/module2-jvm/0.0.1/module2-jvm-0.0.1.jar.sha1",
                    "sample/kmp/module2-jvm/0.0.1/module2-jvm-0.0.1.jar.sha256",
                    "sample/kmp/module2-jvm/0.0.1/module2-jvm-0.0.1.jar.sha512",
                    "sample/kmp/module2-jvm/0.0.1/module2-jvm-0.0.1.module",
                    "sample/kmp/module2-jvm/0.0.1/module2-jvm-0.0.1.module.md5",
                    "sample/kmp/module2-jvm/0.0.1/module2-jvm-0.0.1.module.sha1",
                    "sample/kmp/module2-jvm/0.0.1/module2-jvm-0.0.1.module.sha256",
                    "sample/kmp/module2-jvm/0.0.1/module2-jvm-0.0.1.module.sha512",
                    "sample/kmp/module2-jvm/0.0.1/module2-jvm-0.0.1.pom",
                    "sample/kmp/module2-jvm/0.0.1/module2-jvm-0.0.1.pom.md5",
                    "sample/kmp/module2-jvm/0.0.1/module2-jvm-0.0.1.pom.sha1",
                    "sample/kmp/module2-jvm/0.0.1/module2-jvm-0.0.1.pom.sha256",
                    "sample/kmp/module2-jvm/0.0.1/module2-jvm-0.0.1.pom.sha512",
                    "sample/kmp/module2-linuxarm64",
                    "sample/kmp/module2-linuxarm64/0.0.1",
                    "sample/kmp/module2-linuxarm64/0.0.1/module2-linuxarm64-0.0.1-sources.jar",
                    "sample/kmp/module2-linuxarm64/0.0.1/module2-linuxarm64-0.0.1-sources.jar.md5",
                    "sample/kmp/module2-linuxarm64/0.0.1/module2-linuxarm64-0.0.1-sources.jar.sha1",
                    "sample/kmp/module2-linuxarm64/0.0.1/module2-linuxarm64-0.0.1-sources.jar.sha256",
                    "sample/kmp/module2-linuxarm64/0.0.1/module2-linuxarm64-0.0.1-sources.jar.sha512",
                    "sample/kmp/module2-linuxarm64/0.0.1/module2-linuxarm64-0.0.1.klib",
                    "sample/kmp/module2-linuxarm64/0.0.1/module2-linuxarm64-0.0.1.klib.md5",
                    "sample/kmp/module2-linuxarm64/0.0.1/module2-linuxarm64-0.0.1.klib.sha1",
                    "sample/kmp/module2-linuxarm64/0.0.1/module2-linuxarm64-0.0.1.klib.sha256",
                    "sample/kmp/module2-linuxarm64/0.0.1/module2-linuxarm64-0.0.1.klib.sha512",
                    "sample/kmp/module2-linuxarm64/0.0.1/module2-linuxarm64-0.0.1.module",
                    "sample/kmp/module2-linuxarm64/0.0.1/module2-linuxarm64-0.0.1.module.md5",
                    "sample/kmp/module2-linuxarm64/0.0.1/module2-linuxarm64-0.0.1.module.sha1",
                    "sample/kmp/module2-linuxarm64/0.0.1/module2-linuxarm64-0.0.1.module.sha256",
                    "sample/kmp/module2-linuxarm64/0.0.1/module2-linuxarm64-0.0.1.module.sha512",
                    "sample/kmp/module2-linuxarm64/0.0.1/module2-linuxarm64-0.0.1.pom",
                    "sample/kmp/module2-linuxarm64/0.0.1/module2-linuxarm64-0.0.1.pom.md5",
                    "sample/kmp/module2-linuxarm64/0.0.1/module2-linuxarm64-0.0.1.pom.sha1",
                    "sample/kmp/module2-linuxarm64/0.0.1/module2-linuxarm64-0.0.1.pom.sha256",
                    "sample/kmp/module2-linuxarm64/0.0.1/module2-linuxarm64-0.0.1.pom.sha512",
                    "sample/kmp/module2/0.0.1",
                    "sample/kmp/module2/0.0.1/module2-0.0.1-kotlin-tooling-metadata.json",
                    "sample/kmp/module2/0.0.1/module2-0.0.1-kotlin-tooling-metadata.json.md5",
                    "sample/kmp/module2/0.0.1/module2-0.0.1-kotlin-tooling-metadata.json.sha1",
                    "sample/kmp/module2/0.0.1/module2-0.0.1-kotlin-tooling-metadata.json.sha256",
                    "sample/kmp/module2/0.0.1/module2-0.0.1-kotlin-tooling-metadata.json.sha512",
                    "sample/kmp/module2/0.0.1/module2-0.0.1-sources.jar",
                    "sample/kmp/module2/0.0.1/module2-0.0.1-sources.jar.md5",
                    "sample/kmp/module2/0.0.1/module2-0.0.1-sources.jar.sha1",
                    "sample/kmp/module2/0.0.1/module2-0.0.1-sources.jar.sha256",
                    "sample/kmp/module2/0.0.1/module2-0.0.1-sources.jar.sha512",
                    "sample/kmp/module2/0.0.1/module2-0.0.1.jar",
                    "sample/kmp/module2/0.0.1/module2-0.0.1.jar.md5",
                    "sample/kmp/module2/0.0.1/module2-0.0.1.jar.sha1",
                    "sample/kmp/module2/0.0.1/module2-0.0.1.jar.sha256",
                    "sample/kmp/module2/0.0.1/module2-0.0.1.jar.sha512",
                    "sample/kmp/module2/0.0.1/module2-0.0.1.module",
                    "sample/kmp/module2/0.0.1/module2-0.0.1.module.md5",
                    "sample/kmp/module2/0.0.1/module2-0.0.1.module.sha1",
                    "sample/kmp/module2/0.0.1/module2-0.0.1.module.sha256",
                    "sample/kmp/module2/0.0.1/module2-0.0.1.module.sha512",
                    "sample/kmp/module2/0.0.1/module2-0.0.1.pom",
                    "sample/kmp/module2/0.0.1/module2-0.0.1.pom.md5",
                    "sample/kmp/module2/0.0.1/module2-0.0.1.pom.sha1",
                    "sample/kmp/module2/0.0.1/module2-0.0.1.pom.sha256",
                    "sample/kmp/module2/0.0.1/module2-0.0.1.pom.sha512"
                )
            )
        )
    }
}
